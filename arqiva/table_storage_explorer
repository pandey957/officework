from azure.storage.table import TableService, Entity
table_service = TableService(account_name='rsastoragewestus', account_key='PNaraccyQ7oFvN9oaifPk4fjG8/vN8U+v577zFG+5npVHGXWgbOlGamgBlNjbsZU3rs7Kd7+r/Hnbqbk2Rowqw==')
tasks = table_service.query_entities('StreamOutputTable1')



SELECT
    DeviceProperties.DeviceID,
    DeviceProperties.Manufacture,
    DeviceProperties.ModelNumber,
    DATEADD(second, cast(DeviceRawData.transmissionTime as bigint), '1970-01-01T00:00:00Z') as Transmissiontime,
    DeviceRawData.rawData,
    DeviceRawData.messageSnr,
    DeviceRawData.messageRssi,
    MessageData.messageType,
    MessageData.SWVersion,
    cast(MessageData.pressure as bigint) as pressure,
    cast(MessageData.temperature as bigint) as Temp,
    cast(MessageData.humidity as bigint) as humidity,
    MessageData.i_o_one_state,
    MessageData.status,
    DeviceLocation.location,
    DeviceLocation.postcode,
    DeviceLocation.latitude,
    DeviceLocation.longitude,
    System.Timestamp as times,
    DeviceRawData.transmissionTime as finishtransmissionTime
INTO AnnikOutput1
FROM IoTInputTab1
;


#Empty table_storage
for line in tasks: table_service.delete_entity('StreamOutputTable1',line.PartitionKey, line.RowKey)

table_service.delete_table('StreamOutputTable1')

StreamOutputTable12
count = 0
for line in tasks:
  if line.temp>30:
    count += 1
    print count  

table_service.query_entities('StreamOutputTable1', filter="finishtransmissiontime gt 1463221800")
